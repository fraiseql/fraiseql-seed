# Phase 1-GREENFIELD: fraiseql-data Project Setup

**Phase**: GREENFIELD
**Component**: fraiseql-data
**Objective**: Set up Python package structure, dependencies, and development tooling

---

## Context

Creating a new Python package `fraiseql-data` for AI/LLM-native seed data generation. This package will:
- Auto-generate realistic test data with zero configuration
- Integrate with pytest via decorators
- Support FraiseQL Trinity pattern (pk_*, id, identifier)
- Use fraiseql-uuid for debuggable Pattern UUIDs
- Auto-resolve foreign key dependencies

This is a **greenfield** project - no existing code.

---

## Files to Create

```
fraiseql-seed/
â”œâ”€â”€ pyproject.toml              # UV project configuration
â”œâ”€â”€ README.md                   # Project overview
â”œâ”€â”€ .python-version             # Python 3.11+
â”œâ”€â”€ src/
â”‚   â””â”€â”€ fraiseql_data/
â”‚       â”œâ”€â”€ __init__.py         # Public API exports
â”‚       â”œâ”€â”€ py.typed            # PEP 561 marker
â”‚       â””â”€â”€ _version.py         # Version metadata
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ conftest.py             # Pytest configuration
â”œâ”€â”€ .gitignore                  # Python/UV ignores
â””â”€â”€ uv.lock                     # Generated by uv
```

---

## Implementation Steps

### Step 1: Initialize UV project

```bash
cd /home/lionel/code/fraiseql-seed

# Create pyproject.toml
uv init --lib --name fraiseql-data
```

### Step 2: Configure pyproject.toml

```toml
[project]
name = "fraiseql-data"
version = "0.1.0"
description = "AI/LLM-native seed data generation for FraiseQL projects"
authors = [
    {name = "Lionel", email = "lionel@example.com"}
]
requires-python = ">=3.11"
dependencies = [
    "psycopg[binary]>=3.2.0",
    "faker>=22.0.0",
    "fraiseql-uuid>=0.1.0",
]
readme = "README.md"
license = {text = "MIT"}

[project.optional-dependencies]
dev = [
    "pytest>=8.0.0",
    "pytest-asyncio>=0.23.0",
    "ruff>=0.1.0",
    "mypy>=1.8.0",
]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.ruff]
line-length = 100
target-version = "py311"

[tool.ruff.lint]
select = ["E", "F", "I", "N", "W", "UP"]
ignore = ["E501"]  # Line too long (handled by formatter)

[tool.mypy]
python_version = "3.11"
strict = true
warn_return_any = true
warn_unused_configs = true

[tool.pytest.ini_options]
testpaths = ["tests"]
asyncio_mode = "auto"
```

### Step 3: Create package structure

```python
# src/fraiseql_data/__init__.py
"""
fraiseql-data: AI/LLM-native seed data generation for FraiseQL projects.

Enables LLMs to write complete tests without guessing data structures.
"""

__version__ = "0.1.0"

# Public API (will be implemented in Phase 1)
# from .builder import SeedBuilder
# from .decorators import seed_data
# from .fixtures import seeds_fixture

__all__ = [
    "__version__",
    # "SeedBuilder",
    # "seed_data",
]
```

```python
# src/fraiseql_data/_version.py
"""Version metadata."""

__version__ = "0.1.0"
```

```python
# src/fraiseql_data/py.typed
# PEP 561 marker file for type checking support
```

### Step 4: Create test infrastructure

```python
# tests/conftest.py
"""Pytest configuration and shared fixtures."""

import pytest
import psycopg
from psycopg import Connection


@pytest.fixture
def db_conn() -> Connection:
    """
    Provide a test database connection.

    Note: This will be replaced with actual test database setup.
    For now, returns a connection to a test database that must exist.
    """
    # TODO: Use environment variable or test database
    conn = psycopg.connect(
        "postgresql://localhost/fraiseql_test",
        autocommit=False
    )

    yield conn

    # Rollback any changes
    conn.rollback()
    conn.close()


@pytest.fixture
def test_schema(db_conn: Connection) -> str:
    """
    Create a test schema with sample tables.

    Returns the schema name.
    """
    schema_name = "test_seed"

    with db_conn.cursor() as cur:
        # Drop if exists
        cur.execute(f"DROP SCHEMA IF EXISTS {schema_name} CASCADE")

        # Create schema
        cur.execute(f"CREATE SCHEMA {schema_name}")

        # Create simple test table (Trinity pattern)
        cur.execute(f"""
            CREATE TABLE {schema_name}.tb_manufacturer (
                pk_manufacturer INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
                id UUID NOT NULL DEFAULT gen_random_uuid() UNIQUE,
                identifier TEXT NOT NULL UNIQUE,
                name TEXT NOT NULL,
                email TEXT,
                created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
            )
        """)

        # Create table with FK (Trinity pattern)
        cur.execute(f"""
            CREATE TABLE {schema_name}.tb_model (
                pk_model INTEGER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
                id UUID NOT NULL DEFAULT gen_random_uuid() UNIQUE,
                identifier TEXT NOT NULL UNIQUE,
                name TEXT NOT NULL,
                description TEXT,
                fk_manufacturer INTEGER NOT NULL REFERENCES {schema_name}.tb_manufacturer(pk_manufacturer),
                created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
            )
        """)

        db_conn.commit()

    yield schema_name

    # Cleanup
    with db_conn.cursor() as cur:
        cur.execute(f"DROP SCHEMA IF EXISTS {schema_name} CASCADE")
        db_conn.commit()
```

### Step 5: Create README

```markdown
# fraiseql-data

**AI/LLM-native seed data generation for FraiseQL projects**

Enables LLMs to write complete tests without guessing data structures.

## Features

- ğŸ¤– **Zero-config seed generation** - LLMs write tests without manual seed data
- ğŸ”— **Auto FK resolution** - Automatically handles foreign key dependencies
- ğŸ² **Realistic data** - Faker integration for realistic names, emails, etc.
- ğŸ” **Pattern UUIDs** - Debuggable UUIDs via fraiseql-uuid integration
- ğŸ§ª **Pytest decorators** - Simple `@seed_data()` decorator for tests
- ğŸ—ï¸ **Trinity pattern support** - Auto-generates `pk_*`, `id`, `identifier`

## Quick Start

```python
import pytest
from fraiseql_data import seed_data

@seed_data("tb_manufacturer", count=5)
@seed_data("tb_model", count=20)  # Auto-links to manufacturers
def test_models(seeds):
    # Seeds are auto-generated with realistic data
    assert len(seeds.tb_manufacturer) == 5
    assert len(seeds.tb_model) == 20

    # Foreign keys are automatically resolved
    model = seeds.tb_model[0]
    assert model.fk_manufacturer in [m.pk_manufacturer for m in seeds.tb_manufacturer]
```

## Installation

```bash
uv add fraiseql-data
```

## Development

```bash
# Install dependencies
uv sync --dev

# Run tests
uv run pytest

# Lint
uv run ruff check src/ tests/

# Type check
uv run mypy src/
```

## Status

âš ï¸ **Under Development** - Phase 1 (Zero-Guessing Core) in progress

## License

MIT
```

### Step 6: Create .gitignore

```gitignore
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg

# Virtual environments
venv/
ENV/
env/

# UV
.venv/
uv.lock

# Testing
.pytest_cache/
.coverage
htmlcov/
.tox/

# Type checking
.mypy_cache/
.pytype/

# IDEs
.vscode/
.idea/
*.swp
*.swo
*~

# OS
.DS_Store
Thumbs.db
```

### Step 7: Set Python version

```bash
echo "3.11" > .python-version
```

### Step 8: Install dependencies

```bash
# Install all dependencies including dev
uv sync --dev

# Verify installation
uv run python -c "import psycopg; import faker; print('Dependencies OK')"
```

---

## Verification

### âœ… Verification Commands

```bash
# 1. Check project structure
ls -la src/fraiseql_data/
ls -la tests/

# 2. Verify UV configuration
uv tree

# 3. Verify Python version
python --version  # Should be 3.11+

# 4. Run linter (should pass with no files to check yet)
uv run ruff check src/

# 5. Import package (should work)
uv run python -c "from fraiseql_data import __version__; print(f'Version: {__version__}')"

# 6. Test that dependencies are installed
uv run python -c "import psycopg, faker, fraiseql_uuid; print('All dependencies installed')"
```

### ğŸ“Š Expected Output

```bash
$ uv run python -c "from fraiseql_data import __version__; print(f'Version: {__version__}')"
Version: 0.1.0

$ uv tree
fraiseql-data v0.1.0
â”œâ”€â”€ psycopg[binary] >=3.2.0
â”œâ”€â”€ faker >=22.0.0
â””â”€â”€ fraiseql-uuid >=0.1.0
```

---

## Acceptance Criteria

- âœ… UV project initialized with correct dependencies
- âœ… Package structure follows Python best practices (src layout)
- âœ… Can import `fraiseql_data` module
- âœ… All dependencies installed (psycopg, faker, fraiseql-uuid)
- âœ… Ruff and mypy configured
- âœ… Pytest configured with test fixtures
- âœ… Test database schema fixtures work
- âœ… README documents vision and usage

---

## DO NOT

- âŒ Use old-style `setup.py` (use `pyproject.toml` with UV)
- âŒ Use `psycopg2` (use `psycopg` v3)
- âŒ Put source code in root directory (use `src/` layout)
- âŒ Commit `uv.lock` yet (will be generated)
- âŒ Create implementation files (Phase 1-RED will do that)

---

## Notes

- This is the foundation for Phases 1-4 (RED, GREEN, REFACTOR, QA)
- Test fixtures create a minimal schema with Trinity pattern
- Next phase (RED) will write failing tests for core functionality
- Using `src/` layout for better import isolation during development

---

**Status**: Ready for implementation
**Next Phase**: Phase 1-RED (Write failing tests for core functionality)
